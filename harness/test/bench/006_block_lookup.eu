# Block lookup benchmark
#
# Measures lookup performance on blocks of various sizes.
# The LOOKUPOR BIF builds an index for blocks >= 16 keys,
# so this exercises both the linear find path and the indexed path.

# --- Generate a 50-key block ---

big-block: {
  k01: 1   k02: 2   k03: 3   k04: 4   k05: 5
  k06: 6   k07: 7   k08: 8   k09: 9   k10: 10
  k11: 11  k12: 12  k13: 13  k14: 14  k15: 15
  k16: 16  k17: 17  k18: 18  k19: 19  k20: 20
  k21: 21  k22: 22  k23: 23  k24: 24  k25: 25
  k26: 26  k27: 27  k28: 28  k29: 29  k30: 30
  k31: 31  k32: 32  k33: 33  k34: 34  k35: 35
  k36: 36  k37: 37  k38: 38  k39: 39  k40: 40
  k41: 41  k42: 42  k43: 43  k44: 44  k45: 45
  k46: 46  k47: 47  k48: 48  k49: 49  k50: 50
}

# Perform many repeated lookups to exercise the index path
` :suppress
sum-first-10: big-block.k01 + big-block.k02 + big-block.k03 + big-block.k04 + big-block.k05 + big-block.k06 + big-block.k07 + big-block.k08 + big-block.k09 + big-block.k10

` :suppress
sum-last-10: big-block.k41 + big-block.k42 + big-block.k43 + big-block.k44 + big-block.k45 + big-block.k46 + big-block.k47 + big-block.k48 + big-block.k49 + big-block.k50

` { target: :bench-block-lookup }
bench-block-lookup: {
  first: sum-first-10
  last: sum-last-10
  total: sum-first-10 + sum-last-10
  RESULT: if(total = 510, :PASS, :FAIL)
}
