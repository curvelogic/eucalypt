##
## 074: Sets
##
## Tests for set construction, membership, mutation, algebra, and rendering.
##

## Construction

construction-checks: {
  trues: [
    ([1, 2, 2, 3, 3, 3] set.from-list set.to-list) = [1, 2, 3],
    ([] set.from-list set.to-list) = [],
    (["c", "a", "b"] set.from-list set.to-list) = ["a", "b", "c"],
    ([42] set.from-list set.to-list) = [42],
    ([:a, :b, :a] set.from-list set.size) = 2
  ]
}

## Empty set

empty-checks: {
  trues: [
    (∅ set.to-list) = [],
    (∅ set.size) = 0,
    (∅ set.empty?) = true
  ]
}

## Membership

membership-checks: {
  trues: [
    ([1, 2, 3] set.from-list set.contains?(2)) = true,
    ([1, 2, 3] set.from-list set.contains?(4)) = false,
    (["a", "b"] set.from-list set.contains?("a")) = true,
    (∅ set.contains?(1)) = false,
    ([:a, :b, :c] set.from-list set.contains?(:b)) = true
  ]
}

## Size

size-checks: {
  trues: [
    ([1, 2, 3] set.from-list set.size) = 3,
    ([1, 1, 1] set.from-list set.size) = 1,
    (∅ set.size) = 0
  ]
}

## Add and remove

mutation-checks: {
  trues: [
    (∅ set.add(1) set.add(2) set.to-list) = [1, 2],
    ([1, 2] set.from-list set.add(1) set.size) = 2,
    ([1, 2, 3] set.from-list set.remove(2) set.to-list) = [1, 3],
    ([1, 2] set.from-list set.remove(9) set.to-list) = [1, 2]
  ]
}

## Set algebra

algebra-checks: {
  trues: [
    {
      a: [1, 2] set.from-list
      b: [2, 3] set.from-list
    }.(a set.union(b) set.to-list) = [1, 2, 3],
    {
      a: [1, 2, 3] set.from-list
      b: [2, 3, 4] set.from-list
    }.(a set.intersect(b) set.to-list) = [2, 3],
    {
      a: [1, 2] set.from-list
      b: [3, 4] set.from-list
    }.(a set.intersect(b) set.to-list) = [],
    {
      a: [1, 2, 3] set.from-list
      b: [2, 3] set.from-list
    }.(a set.diff(b) set.to-list) = [1],
    {
      a: [1, 2] set.from-list
    }.(a set.diff(∅) set.to-list) = [1, 2],
    {
      a: [1, 2] set.from-list
    }.(a set.union(∅) set.to-list) = [1, 2]
  ]
}

## Round-trip and rendering

render-checks: {
  trues: [
    {
      original: [3, 1, 2] set.from-list
      trip: original set.to-list set.from-list
    }.((original set.to-list) = (trip set.to-list)),
    ([3, 1, 2] set.from-list set.to-list) = [1, 2, 3],
    (["c", "a", "b"] set.from-list set.to-list) = ["a", "b", "c"],
    (∅ set.to-list) = [],
    {
      my-set: [1, 2, 3] set.from-list set.to-list
    } = {my-set: [1, 2, 3]},
    ([1, 2] set.from-list set.empty?) = false,
    ([1] set.from-list set.empty?) = false
  ]
}

pass: [
  construction-checks.trues all-true?,
  empty-checks.trues all-true?,
  membership-checks.trues all-true?,
  size-checks.trues all-true?,
  mutation-checks.trues all-true?,
  algebra-checks.trues all-true?,
  render-checks.trues all-true?
] all-true?

RESULT: if(pass, :PASS, :FAIL)
